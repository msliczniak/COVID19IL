#!/bin/sh

#d=-dpng
d=-dpngcairo

awk() {
	/usr/bin/awk "$@"
}

foo() {
	shift $1;
	echo "$1" | sed 's/[^-]*-//; s/T.*//'
}

da=`foo $# "$@"`

for co in Illinois Lake Kane; do
	for rs in 'confirmed cases' deaths 'total tested'; do
		./totals select="$co" result="$rs" "$@" >total

		# if there is zero, don't gen plots
		awk 'BEGIN{s=1}$1!="0"{s=0;exit}END{exit s}' total || break

		./plot -gst "$co $rs $da" $d -o "$co"-"$rs"-tot.png total

		<total ./cum | awk 'NF==2{print NR-1,$2}' | tail>\%chg
		./plot -gst "$co $rs $da" $d -o "$co"-"$rs"-chg.png \%chg

		<total ./log | awk 'NF==2{print NR-1,$2}'>lg10
		./plot -gst "$co $rs $da" $d -o "$co"-"$rs"-log.png lg10

		# no tested totals per county
		case "$co"-"$rs" in
		  Illinois-*)
			;;
		  *-deaths)
			break
			;;
		esac
	done
done
